CREATE FUNCTION [dbo].[fnCarType]
(@site INT)
RETURNS VARCHAR(250)
AS 
BEGIN
     DECLARE @id INT 
     DECLARE @Name  VARCHAR(255)
     SET @Name = ''
     DECLARE CURSOR_TEMPORAL CURSOR FOR
     SELECT Name, id FROM types AS ty
     LEFT JOIN site_x_types AS sxt ON ty.id = sxt.types_id
     WHERE sxt.sites_id = @site
     OPEN CURSOR_TEMPORAL 
     FETCH NEXT FROM CURSOR_TEMPORAL INTO @id
     WHILE @@FETCH_STATUS = 0 
           BEGIN 
                  SET @Name = @Name  + @id + ' , '
                  FETCH NEXT FROM CURSOR_TEMPORAL INTO @id
           END 
     IF LEN (@Name) > 0 SELECT @Name  = LEFT  (@Name , LEN (@Name)-1)
RETURN @Name
END
    